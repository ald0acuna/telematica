<!DOCTYPE HTML>
<html>
  <head>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/loginstyle.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <title>Login | Proyecto Covid</title>

    <script src='/socket.io/socket.io.js'></script> 
    <script> var socket = io.connect('http://54.196.238.128:4500/');</script>
  </head>
  <body>

    <div class="canvas-box">
      <canvas id="myChart"></canvas>
    </div>
    
    <div class="login-box" >
      <img src="img/logoUninorte.png" class="avatar" alt="Logo de uninorte">
      <h2>LOGIN</h2>
      <form id="validacion"  >
        <label for="username">Usuario</label>
        <input type="text" id="username"  placeholder="introduzca usuario">
        <label for="password">Contraseña</label>
        <input type="password" id="password"  placeholder="introduzca contraseña">
        
        <input type="submit" value="Iniciar Sesion">
      </form>

      <a href=registro.html>¿No estás registrado?</a>
    </div>
    
    <script>
      
      const form = document.getElementById('validacion')
      
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        var sw=0;

        nombre = e.target.username.value;
        password = e.target.password.value;

        var valid = [];

        valid.push(nombre);
        valid.push(password);

        socket.emit("validar",valid);
        i=1;
        socket.on('loginResp',info=>{
          console.log("info: "+info);
          
          for (i of info){
            var rol = i.ROL
          }
          console.log(rol);
          if (info.length ==0){
            alert("Su usuario o contraseña son incorrectos");
            location.href="login.html";
            
          }else{
            if(rol== 2){ 
              location.href="lobbyayudante.html"
            }else{
              location.href="lobbymedico.html"
            }
            
            //location.href="lobby.html";
          }
          
        });
      });
    </script>
    <script>
      var ctx= document.getElementById("myChart").getContext("2d");
      var myChart= new Chart(ctx,{
        type:'line',
        data: {
          labels:[1,20,50,60,70,80],
          datasets:[
            {
              label:'Registrados',
              //fill: false,
              data:[9,15,19,24,30,35],
              backgroundColor: "rgb(66, 134, 244, 0.05)",
              borderColor: "rgb(55, 112, 100)"
            },
            {
              label:'Muertes',
              //fill: false,
              data:[13,20,27,10],
              backgroundColor: "rgb(66, 134, 244, 0.05)",
              borderColor: "rgb(66, 134, 244)"
            }
          ]
          
        },
        options:{
          scales:{
            yAxes:[{
              ticks:{
                beginAtZero:true
              }
            }]
          }
        }
      });
    </script>
    
  </body>
</html>